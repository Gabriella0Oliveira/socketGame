# üöÄ Space Invaders Multiplayer üëæ 
Este projeto foi desenvolvido como requisito avaliativo da disciplina "CET098 - REDE DE COMPUTADORES I" do curso de Ci√™ncia da Computa√ß√£o - Universidade Estadual de Santa Cruz.

Nesta vers√£o do famoso arcade game 2D "Space Invaders", dois players se reunem utilizando uma rede local para combater os aliens antes que o tempo acabe. A vit√≥ria √© alcan√ßada quando os jogadores eliminam 100 inimigos em 2 minutos.     

O jogo est√° implementado em linguagem Python utilizando o protocolo de comunica√ß√£o UDP. Para a transmiss√£o de dados entre as partes cliente - servidor s√£o utilizadas, principalmente, tr√™s bibliotecas: Socket, Threading e Pickle. 

### üìåSobre este projeto:
1.  Software
    - [Objetivos e motiva√ß√µes.](#)
    - [Escolhendo o protocolo.](#)
    - [Estrutura do c√≥digo](#Estrutura-do-c√≥digo.)
2.  Protocolo usado na camada de aplica√ß√£o
    - [Estados](#)
    - [Mensagens](#)
    - [Eventos](#)

3. Como jogar
   - [Requisitos](#)
   - [Instru√ß√µes de instala√ß√£o](#)
   - [Controles](#)  


![imagem](<Imagem do WhatsApp de 2023-12-04 √†(s) 23.09.38_52090821.jpg>)

## Software üõ†
Entendendo um pouco sobre o funcionamento do c√≥digo e a sua estrutura.
### Objetivos e motiva√ß√µes.
O jogo de shooting "Space Invaders" √© bem querido na comunidade gamer, optamos por criar uma vers√£o ainda mais divertida e interativa utilizando uma conex√£o local para conectar dois jogadores. O principal foco, entretanto, foi o aprendizado dos conceitos abordados durante o estudo da disciplina de Redes. Principalmente o gereciamento da comunica√ß√£o de dados entre um cliente e um servidor utilizando um protocolo apropriado. Desta maneira, √© esperado que o software seja capaz de lidar com o envio e recebimentos de dados atualizando a execu√ß√£o do jogo nas partes envolvidas a cada evento ocorrido. 

### Escolhendo o protocolo.
O protocolo utilizado na implementa√ß√£o foi o UDP (User Datagram Protocol). Durante a escolha buscamos analisar as considera√ß√µes espec√≠ficas do projeto. O UDP foi preferido devido √† sua simplicidade e efici√™ncia em ambientes nos quais a perda ocasional de pacotes √© aceit√°vel. No contexto de um jogo multiplayer, a velocidade de transmiss√£o √© crucial para manter a jogabilidade fluida em tempo real, e o UDP, por ser um protocolo n√£o orientado a conex√£o e de baixa sobrecarga, permite uma comunica√ß√£o mais r√°pida do que protocolos mais robustos, como o TCP. Embora o UDP n√£o garanta a entrega de pacotes, percebemos que isso n√£o afeta em grande escala a jogabilidade do jogo.

### Estrutura do c√≥digo.
O c√≥digo est√° dividido em dois arquivos:
- `server.py` lida com a implementa√ß√£o do servidor.
- `client.py` lida com a implementa√ß√£o do cliente. 

O fluxo do programa segue os seguintes passos: 
- Conex√£o Inicial:
O jogo √© inicializado com a execu√ß√£o do c√≥digo server, que prepara o ambiente e aguarda conex√µes de clientes. 
Os clientes s√£o jogadores individuais que se conectam com o server atrav√©s de sockets UDP, estabelecendo a comunica√ß√£o.

- Cada jogador conectado controla a sua pr√≥pia nave e pode observar os movimentos realizados pelo outro jogador conectado. 
Os jogadores precisam eliminar uma quantidade determinada de inimigos em um limite de tempo para vencer. 

- A comunica√ß√£o entre clientes e o servidor √© realizada por meio de troca de mensagens usando a biblioteca de serializa√ß√£o Pickle em Python.
Os cliente enviam informa√ß√µes ao servidor sobre seus eventos como: movimenta√ß√£o, tiros ou kills feitas. O servidor ent√£o, envia atualiza√ß√µes do estado do jogo. 

- O jogo possui alguns feedbacks visuais e sonoros, como: Um inimigo ao morrer dispara uma anima√ß√£o de explos√£o. O jogo ao ser iniciado reproduz uma m√∫sica de fundo. 
 
## Sobre o protocolo usado na camada de aplica√ß√£o
O protocolo na camada de aplica√ß√£o se baseia em uma comunica√ß√£o cliente-servidor utilizando sockets UDP em Python. Cada entidade (cliente e servidor) possui um socket dedicado para a troca de mensagens. As informa√ß√µes s√£o transmitidas na forma de objetos serializados, empregando a biblioteca `Pickle` ou strings conforme o contexto.


### Estados
A l√≥gica de comunica√ß√£o segue um modelo no qual o cliente envia eventos (movimentos e tiros) para o servidor. Este, por sua vez, processa essas a√ß√µes e responde com o estado atualizado do jogo. Essa comunica√ß√£o √© realizada por meio de datagramas, garantindo uma troca de dados leve e adequada para jogos em tempo real.

Ao ser iniciado, o servidor espera conex√µes dos clientes, gerenciando v√°rias inst√¢ncias de jogadores por meio de um dicion√°rio identificado pelos respectivos endere√ßos. Para cada jogador √© atribu√≠do um identificador √∫nico fornecido pelo servidor.

A l√≥gica de atualiza√ß√£o no servidor abrange a movimenta√ß√£o dos jogadores, disparo de tiros, cria√ß√£o de aliens, detec√ß√£o de colis√µes e a contagem do objetivo a ser alcan√ßado. O estado atualizado do jogo, contendo informa√ß√µes sobre o andar do jogo, √© enviado de volta individualmente para cada cliente.

Ambos, cliente e servidor, implementam threads para executar tarefas simult√¢neas, como a recep√ß√£o cont√≠nua de dados do cliente ou o processamento de atualiza√ß√µes do servidor.

### Eventos 
1.  Registro do Jogador.
    -   **Cliente para Servidor:** Quando um cliente inicia sua participa√ß√£o no jogo, envia uma mensagem solicitando o registro ao servidor. Esta mensagem n√£o cont√©m um 'id' associado, indicando ao servidor que o cliente est√° se registrando pela primeira vez.
    -   **Servidor para Cliente:** Em resposta, o servidor atribui um 'id' √∫nico ao jogador e fornece a posi√ß√£o inicial. Isso estabelece a identidade do jogador e inicia a troca de informa√ß√µes.
2. Movimento do Jogador.
   - **Cliente para Servidor:** Quando o jogador se move, uma mensagem informando a nova posi√ß√£o √© enviada ao servidor. A inclus√£o do 'id' garante que o servidor possa associar corretamente a mensagem √† entidade espec√≠fica.
3. Disparo de Tiro.
   - **Cliente para Servidor:** Quando um jogador dispara, uma mensagem √© enviada ao servidor indicando a inten√ß√£o. A posi√ß√£o inicial do tiro √© crucial para determinar a origem e a trajet√≥ria do proj√©til.
4. Atualiza√ß√£o do Estado do Jogo.
   - **Servidor para Cliente:** Periodicamente, o servidor envia mensagens de atualiza√ß√£o para cada cliente, contendo informa√ß√µes sobre jogadores, tiros, aliens e o objetivo atual. A inclus√£o do 'id' garante que cada cliente receba as informa√ß√µes pertinentes ao seu contexto.    
5. Alien Eliminado.
   - **Servidor para cliente:** O servidor remove o alien eliminado da lista de aliens ativos, atualiza a pontua√ß√£o do jogador e o objetivo atual do jogo. Uma mensagem de atualiza√ß√£o do estado √© enviada a todos os clientes.
 

### Mensagens
O protocolo adota uma estrutura comum para todas as mensagens, baseada em um dicion√°rio Python serializado por meio do m√≥dulo pickle. A inclus√£o de campos como 'id', 'evento' e 'posicao' fornece uma base s√≥lida para identifica√ß√£o, categoriza√ß√£o e localiza√ß√£o espacial das entidades no jogo.
  #### Mensagens do cliente para o servidor:
- Mover a nave do Jogador:

```py
{
 'id': ID_DO_JOGADOR,
 'evento': 'movimento',
 'posicao': (X, Y)
}
```
- Disparar o Tiro:
```py
 {
 'id': ID_DO_JOGADOR,
 'evento': 'tiro',
 'posicao': (X, Y)
}
```
  #### Mensagens do servidor para o cliente:
- Mensagem de Atualiza√ß√£o do Estado: 
```py
{
 'jogadores': {
    ID_JOGADOR_1: {'posicao': (X, Y)},
    ID_JOGADOR_2: {'posicao': (X, Y)},
    ...
 },
    'tiros': [(X1, Y1), (X2, Y2), ...],
    'aliens': [(X1, Y1), (X2, Y2), ...],
    'objetivo': OBJETIVO_ATUAL
}
```
#### Estabelecimento da Conex√£o:
- Cria√ß√£o de Sockets:
```
Tanto o cliente quanto o servidor criam sockets UDP, usando socket.socket(socket.AF_INET, socket.SOCK_DGRAM).
```
- Defini√ß√£o do Endere√ßo e Porta do Servidor:
```
Ambos especificam o endere√ßo IP e a porta do servidor a qual querem se conectar 
utilizando a vari√°vel server_address = ('192.168.0.104', 5555).

```
- Vincula√ß√£o do Socket √† Porta (Apenas Servidor):
```
O servidor vincula o socket criado ao endere√ßo escolhido com SERVER_SOCKET.bin (SERVER_ADDRESS).
```
- Envio de Dados do Cliente para o Servidor:
```
O cliente envia dados serializados para o servidor utilizando client_socket.sendto(pickle.dumps(dados), server_address).
```
- Recebimento de Dados no Servidor:
```
O servidor recebe dados do cliente com: data, address = 
SERVER_SOCKET.recvfrom(4096).
```
- Processamento dos Dados no Cliente e no Servidor:
```
Tanto o cliente quanto o servidor desserializam os dados recebidos utilizando 
pickle.loads(data).
```
- Atualiza√ß√£o da Interface Gr√°fica ou L√≥gica do Jogo:
```
Ambos atualizam a interface gr√°fica ou a l√≥gica do jogo com base nos dados recebidos.
```
- Envio de Dados Atualizados para os Clientes:
```
O servidor envia dados atualizados para os clientes com: SERVER_SOCKET.sendto(serialized_data, address).
```
- Thread para Receber Dados no Servidor:
```
O servidor utiliza uma thread separada (thread_receber) para receber continuamente 
dados dos clientes
```
- Tratamento de Eventos e L√≥gica do Jogo:
```
Ambos, cliente e servidor, realizam o processamento de eventos e a atualiza√ß√£o da 
l√≥gica do jogo
```
- Compartilhamento de Dados entre Threads (Apenas Servidor):
```
O servidor utiliza um mecanismo de trava (LOCK) para garantir a consist√™ncia ao 
acessar dados compartilhados entre threads.
```
- Serializa√ß√£o e Desserializa√ß√£o:
```
Ambos utilizam o m√≥dulo pickle para serializar (transformar em bytes) e 
desserializar (reverter de bytes para objeto) os dados antes do envio e ap√≥s a recep√ß√£o.
```

## Como jogar üéÆüé≤
Para ter acesso ao jogo √© necess√°rio que voc√™ fa√ßa o download de todos os arquivos presentes neste reposit√≥rio. Incluindo os arquivos de "Imagens" / client.py / server.py.

### Requisitos 
Certifique-se de que todos os arquivos est√£o localizados em uma √∫nica pasta e que a sua m√°quina possui o `Python` instalado. 
- [Python](https://www.python.org/downloads/)

### Instru√ß√µes de Instala√ß√£o
Ao abrir os arquivos client.py e server.py altere o endere√ßo IP em ambos c√≥digos para o ip da m√°quina que ir√° ser o host do jogo (servidor). N√£o se esque√ßa que ambas m√°quinas precisam estar na mesma rede. 

```
SERVER_ADDRESS = ('seu.ip.aqui', porta)
```
Para encontrar o seu ip voc√™ pode utilizar esses comandos:

- Ambiente windows  
```
ipconfig
```
![Alt text](image.png)

- Ambiente Linux
```
ifconfig
```
![Alt text](image-1.png)

#### IPs configurados
Agora voc√™ pode executar o server.py em sua m√°quina. E intruir para que seus parceiros de jogo executem o client.py. 
> Caso voc√™ esteja sozinho pode executar o client.py em um terminal separado que ter√° o mesmo resultado! 

### Controles 

Para movimentar a nave basta utilizar as teclas de dire√ß√£o e para atirar utilize a barra de espa√ßo.  



### Feito por:  
>‚òï [Gabriella Oliveira](https://github.com/Gabriella0Oliveira)  
>‚òï [Di√™go Farias](https://github.com/Gabriella0Oliveira)